<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Conheça o Colégio Santa Catarina Juiz de Fora, o melhor colégio de Juiz de Fora">
    <meta property="og:image" content="img/banner.webp">
    <link rel="shortcut icon" href="favicon/icon.webp" type="image/x-icon">
    <link rel="stylesheet" href="styles/variables.css">
    <link rel="stylesheet" href="styles/home.css">
    <link rel="stylesheet" href="styles/description.css">
    <link rel="stylesheet" href="styles/carousel.css">
    <link rel="stylesheet" href="styles/header.css">
    <link rel="stylesheet" href="styles/menu.css">
    <link rel="stylesheet" href="styles/load.css">
    <title>Colégio Santa Catarina</title>
</head>

<body>

    <div class="load">
        <div class="readed"></div>
        <header>
            <section>
                <aside class="logo" onclick="toScroll(0, undefined, this)">
                    <img src="img/icon.webp" alt="icone">
                </aside>
                <aside class="content">
                    <div class="menu">
                        <span class="one"></span>
                        <span class="two"></span>
                        <span class="three"></span>
                    </div>
                    <!-- <nav>
                        <a href="">Home</a>
                    </nav> -->
                </aside>
            </section>
        </header>
        <main>
            <section id="home">
                <aside class="about">
                    <h1><span>COLÉGIO</span> <br>
                        <span>Santa</span> <span>Catarina</span>
                    </h1>
                </aside>
            </section>

            <section id="description">
                <aside class="container">
                    <h1 class="tittle">Sobre o Colégio</h1>

                    <div>
                        <h2><span id="age">0</span> anos</h2>
                    </div>

                    <p>Há mais de 100 anos, aproximamos nossos alunos do conhecimento. Preparando-os em cada etapa da
                        vida para serem os autores de suas escolhas. Acreditamos nas conquistas de cada um, incentivando
                        a autonomia para se tornarem cidadãos críticos, que possam atuar em suas vidas e nas comunidades
                        em que vivem, com a certeza que, apenas juntos, podemos construir um mundo melhor.​</p>
                </aside>
            </section>

            <section id="carousel">
                <aside>
                    <div class="container">

                    </div>
                </aside>
            </section>
        </main>
        <footer></footer>

        <div id="back" onclick="toScroll(0, 'back', this)">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M17.6568 8.96219L16.2393 10.3731L12.9843 7.10285L12.9706 20.7079L10.9706 20.7059L10.9843 7.13806L7.75404 10.3532L6.34314 8.93572L12.0132 3.29211L17.6568 8.96219Z"
                    fill="currentColor" />
            </svg>
        </div>
    </div>

    <script>

        document.body.innerHTML +=
            `
            <section id="loading">
        <div class="progress"></div>
        <section id="error">
            <aside>
                <span class="img">
                    <p>ERROR</p>
                    <img src="img/load/error.png" alt="error">
                </span>

                    <span class="message">
                        <ul id="errors"></ul>
                    </span>
            </aside>

        </section>

        <section id="succes">
            <aside>
                <span class="img">
                    <img src="img/load/download.gif" alt="imagem de download concluído">
                </span>
                <span class="message">
                    <p>
                        The download of the caches has been successfully completed.
                    </p>
                </span>
            </aside>
        </section>

        <aside class="container">
            <aside class="logo">
                <img src="img/icon.webp" alt="Colegio Santa Catarina logo">
            </aside>
            <aside class="description">
                <img src="img/logo-colegio-juizdefora.webp" alt="colegio santa catarina juiz de fora">
            </aside>
        </aside>

        <aside class='info'>
            <p>Caching: <span id="info"></span></p>

            <p id="percentage">0%</p>
        </aside>
    </section>

        `;

        const sectError = document.getElementById('errors');
        const progressBar = document.getElementById('percentage');

        if (localStorage.getItem("cacheComplete") === 'error') {
            async function clearAllCaches() {
                try {
                    if ('caches' in window) {
                        const cacheNames = await caches.keys();
                        console.log('Caches encontrados:', cacheNames);
                        await Promise.all(cacheNames.map(cacheName => caches.delete(cacheName)));
                        console.log('Todos os caches foram apagados.');
                    } else {
                        console.warn('Caches não são suportados neste navegador.');
                    }
                } catch (error) {
                    console.error('Erro ao apagar os caches:', error);
                }
            }

            async function clearIndexedDB() {
                try {
                    if (window.indexedDB) {
                        const dbs = await window.indexedDB.databases();
                        await Promise.all(dbs.map(db => new Promise((resolve, reject) => {
                            const request = window.indexedDB.deleteDatabase(db.name);
                            request.onsuccess = resolve;
                            request.onerror = reject;
                        })));
                        console.log('Todos os bancos de dados IndexedDB foram apagados.');
                    } else {
                        console.warn('IndexedDB não é suportado neste navegador.');
                    }
                } catch (error) {
                    console.error('Erro ao apagar IndexedDB:', error);
                }
            }

            async function clearServiceWorkers() {
                try {
                    if ('serviceWorker' in navigator) {
                        const registrations = await navigator.serviceWorker.getRegistrations();
                        await Promise.all(registrations.map(registration => registration.unregister()));
                        console.log('Todos os service workers foram desregistrados.');
                    } else {
                        console.warn('Service Workers não são suportados neste navegador.');
                    }
                } catch (error) {
                    console.error('Erro ao desregistrar service workers:', error);
                }
            }

            function clearLocalStorage() {
                try {
                    localStorage.clear();
                    console.log('Local storage foi apagado.');
                } catch (error) {
                    console.error('Erro ao apagar o local storage:', error);
                }
            }

            async function clearAllData() {
                await clearAllCaches();
                await clearIndexedDB();
                await clearServiceWorkers();
                clearLocalStorage();
                console.warn('Todos os caches, IndexedDB, service workers e local storage foram apagados devido a um erro.');
            }

            clearAllData();
        } else {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('JS/cache.js').then(function (registration) {
                    console.log('Service Worker registered with scope:', registration.scope);

                    function sendMessageToServiceWorker(worker) {
                        if (worker) {
                            worker.postMessage({ action: 'CACHE_STATUS' });
                        } else {
                            console.log('Service Worker is not ready to receive messages.');
                        }
                    }

                    if (registration.active) {
                        sendMessageToServiceWorker(registration.active);
                    } else if (registration.waiting) {
                        sendMessageToServiceWorker(registration.waiting);
                    } else if (registration.installing) {
                        registration.installing.addEventListener('statechange', function () {
                            if (this.state === 'activated') {
                                sendMessageToServiceWorker(registration.active);
                            }
                        });
                    }
                }).catch(function (error) {
                    console.error('Service Worker registration failed:', error);
                });

                navigator.serviceWorker.addEventListener('message', function (event) {
                    if (event.data.type === 'CACHE_COMPLETE') {
                        localStorage.setItem('cacheComplete', 'true');
                        const JS = ['main.js', 'cache.js', 'scroll.js', 'sections.js'];
                        JS.forEach((i) => {
                            const element = document.createElement("script");
                            element.src = `JS/${i}`;
                            document.body.appendChild(element);
                        });
                        console.log('Cache download completed and recorded in localStorage');
                    } else if (event.data.type === 'CACHE_UPDATED') {
                        console.log('Cache updated, please refresh the page to get the latest content.');
                    } else if (event.data.type === 'ERROR') {


                        localStorage.setItem('cacheComplete', 'error');

                        sectError.innerHTML += `<li>${event.data.message}</li>`;

                    } else if (event.data.type === 'PROGRESS') {
                        let progress = event.data.progress;
                        console.log('progresso: ' + progress)
                        progressBar.style.width = progress + '%';
                        progressBar.textContent = progress + '%';
                    }
                });
            }
        }



    </script>
</body>

</html>